<div class="mt-4">
    <app-button-radio-active titulo="Compras productos locales" filtroBoton="btnsComprasProLocales" cstyle="bg-gradient-primary text-white" [groupButton]="vmButtons" (onMetodoGlobal)="metodoGlobal($event)" icono="fas fa-file-alt">
        <div class="row mt-2">
            <div class="col-sm-4">

                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Tipo documento</span>
                    </div>
                    <select class="form-control form-control-sm custom-select" [(ngModel)]="dataBuy.idTipDocSelect" [disabled]="!actions.dComponet " id="idTipDocSelect" (ngModelChange)="cancelBuy($event)">
                        <option *ngFor="let d of dataBuy.tip_doc" [value]="d.id">
                            {{d.nombre}}
                        </option>
                    </select>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Tipo
                            pago</span>
                    </div>
                    <select class="form-control form-control-sm custom-select" [(ngModel)]="dataBuy.tipoPagoSelect" (ngModelChange)="changeDisabledBtn()" [disabled]="!actions.dComponet " id="idTipoPagoSelect">
                        <option [value]="0">Seleccione tipo pago</option>
                        <option *ngFor="let d of dataBuy.tipo_pago" [value]="d.valor">
                            {{d.valor}}
                        </option>
                    </select>
                    <div class="input-group-append">
                        <button class="btn btn-primary" (click)="setNumCuotas()" style="box-shadow: unset;outline: unset;" id="idbtndifered" [disabled]="!flagBtnDired " placement="top" ngbTooltip="Diferir cuotas">
                            <i class="fa fa-pencil" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-sm-4">
                <app-cc-input-group-prepend label="Fecha compra" styleSpan="size-span-campo">
                    <ejs-datepicker [(ngModel)]="fecha" class="form-control" name="dateFrom" format='yyyy-MM-dd' id="idNominaDatef">
                    </ejs-datepicker>
                </app-cc-input-group-prepend>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">No. Autorización</span>
                    </div>
                    <input placeholder="Número autorización" type="text" class="form-control form-control-sm" id="idNumFac" [(ngModel)]="dataBuy.numAut" [disabled]="!actions.dComponet">

                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Forma
                            pago</span>
                    </div>
                    <select class="form-control form-control-sm custom-select" [(ngModel)]="dataBuy.formaPagoSelect" [disabled]="!actions.dComponet" id="idFormaPago">
                        <option [value]="0">Seleccione forma pago</option>
                        <option *ngFor="let d of dataBuy.forma_pago" [value]="d.valor">
                            {{d.valor}}
                        </option>
                    </select>
                </div>
            </div>

            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Subtotal</span>
                    </div>
                    <input type="text" class="form-control form-control-sm text-right" placeholder="$ {{dataTotales.subTotalPagado.toFixed(4)}}" min="0" disabled>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">No. Documento</span>
                    </div>
                    <input placeholder="Número documento" type="text" class="form-control form-control-sm" id="idNumDoc" [(ngModel)]="dataBuy.numDoc" [disabled]="!actions.dComponet">

                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Estado</span>
                    </div>
                    <select class="form-control form-control-sm custom-select" [(ngModel)]="dataBuy.estado" [disabled]="!disestado">
                        <option value="A">Activo</option>
                        <option value="I">Inactivo</option>
                    </select>
                </div>
            </div>
            <!-- <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Proveedor</span>
                    </div>
                    <ng-select class="form-control" [searchable]="true" [(ngModel)]="dataBuy.rucProvider"
                        [clearable]="false" [disabled]="!actions.dComponet" id="idRucProv">
                        <ng-option [value]="0">Seleccione proveedor</ng-option>
                        <ng-option *ngFor="let d of arrayProveedor" [value]="d.num_documento">
                            {{d.razon_social}}</ng-option>
                    </ng-select>
                </div>
            </div> -->
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">{{ivaConverter}} %
                            Iva</span>
                    </div>
                    <input type="text" class="form-control form-control-sm  text-right" placeholder="$ {{dataTotales.ivaPagado.toFixed(4)}}" min="0" disabled>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Proveedor</span>
                    </div>
                    <ng-select class="form-control" [searchable]="true" [(ngModel)]="dataBuy.rucProvider" [clearable]="false" [disabled]="!actions.dComponet" id="idRucProv">
                        <ng-option [value]="0">Seleccione proveedor</ng-option>
                        <ng-option *ngFor="let d of arrayProveedor" [value]="d.num_documento">
                            {{d.razon_social}}</ng-option>
                    </ng-select>
                </div>
            </div>
            <!-- <div class="col-sm-4">
                <div class="input-group pt-2">
                    <div class="input-group-prepend">
                        <span class="input-group-text" style="background-color: #404a63; color: white;"
                            placeholder="Ingrese observación">Observación</span>
                    </div>
                    <textarea name="" id="idTexObserv" [(ngModel)]="dataBuy.observation" [disabled]="!actions.dComponet"
                        class="form-control form-control-sm" placeholder="Ingrese una observación"></textarea>
                </div>
            </div> -->
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Usuario recibe</span>
                    </div>
                    <select class="form-control form-control-sm custom-select" [(ngModel)]="dataBuy.userSelect" [disabled]="!actions.dComponet" id="idUserReceibed">
                        <option [value]="0">Seleccione usuario</option>
                        <option *ngFor="let d of dataBuy.dataUsuario" [value]="d.id_usuario">{{d.nombre}}
                        </option>
                    </select>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Total</span>
                    </div>
                    <input type="text" class="form-control form-control-sm  text-right" placeholder="$ {{dataTotales.totalPagado.toFixed(4)}}" min="0" disabled>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-8">
                <div class="input-group pt-2">
                    <div class="input-group-prepend">
                        <span class="input-group-text" style="background-color: #404a63; color: white;" placeholder="Ingrese observación">Observación</span>
                    </div>
                    <textarea name="" id="idTexObserv" [(ngModel)]="dataBuy.observation" [disabled]="!actions.dComponet" class="form-control form-control-sm" placeholder="Ingrese una observación"></textarea>
                </div>
            </div>
        </div>
        <div class="row justify-content-center mt-4 mb-3  pl-2 pr-2">
            <div class="col-12 filters pl-2 pr-2 ">
                <div class="row justify-content-end pt-2">
                    <div class="col-3 col-sm-3 col-md-2 col-lg-2 col-xl-2 text-right btn-add">
                        <button class="btn btn-success btn-sm" placement="top" ngbTooltip="Añadir Items" (click)="addItems()" [disabled]="!actions.dComponet">
                            <i class="fa fa-plus" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-12  pl-3 pr-3 mt-2">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th># Items</th>
                                    <th>Nombre</th>
                                    <th>Código</th>
                                    <th>Descripción</th>
                                    <th>Cantidad</th>
                                    <th>P/U</th>
                                    <th>Total</th>
                                    <th style="text-align: center;">Acción</th>
                                </tr>
                            </thead>
                            <tbody style="width: 100%;">
                                <tr *ngFor="let d of dataProducto; let i = index">
                                    <td style="width: 7%;text-align: center;" class="pt-3">{{i+1}}</td>
                                    <td style="width: 20%;">
                                        <div>
                                            <ng-select id="IdRolesUsersDoc" class="form-control custom" appendTo="body" [searchable]="true" [disabled]="!actions.dComponet " [clearable]="false" [(ngModel)]="d.productSelect" (ngModelChange)="getDataProduct($event,i)">
                                                <ng-option [value]="0">Seleccione Producto</ng-option>
                                                <ng-option *ngFor="let d of arrayProductos" [value]="d.id_producto">
                                                    {{d.nombre}}</ng-option>
                                            </ng-select>
                                        </div>
                                    </td>
                                    <td style="width: 15%;text-align: center;padding-top: 14px;">{{d.codigo}}</td>
                                    <td style="width: 21%;">
                                        <textarea class="form-control form-control-sm" [(ngModel)]="d.description" placeholder="Ingrese descripción" [disabled]="!actions.dComponet  " rows="1">
                                       </textarea>
                                    </td>
                                    <td style="width: 9%;">
                                        <div>
                                            <input type="text" class="form-control form-control-sm" placeholder="0.0000" style="text-align: right;padding-right: 5px;" [(ngModel)]="d.quantity" (keyup)="sumTotal(i)" min="0" (keypress)="commonServices.FormatDecimalVal($event)" [disabled]="!actions.dComponet  || d.productSelect == undefined  ">
                                        </div>
                                    </td>
                                    <td style="width: 9%;">
                                        <div>
                                            <input type="text" class="form-control form-control-sm" placeholder="$ 0.0000" style="text-align: right;padding-right: 5px;" [(ngModel)]="d.price" (keyup)="sumTotal(i)" min="0" (keypress)="commonServices.FormatDecimalVal($event)" [disabled]="!actions.dComponet || d.productSelect == undefined ">
                                        </div>
                                    </td>
                                    <td style="width: 9%;text-align: right;" class="pt-3">$ {{d.totalItems.toFixed(4)}}
                                    </td>
                                    <td style="width: 10%;text-align: center;">
                                        <button class="btn btn-danger" placement="left" ngbTooltip="Eliminar Items" [disabled]="!actions.dComponet" (click)="deleteItems(i)"><i
                                                class="fa fa-trash-o" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center mt-4 mb-3  pl-2 pr-2">
            <div class="col-12 pl-2 pr-2 ">
                <fieldset class="border p-2 mb-1  filters">
                    <legend class="w-auto h6">Listado Compras Registradas</legend>
                    <div class="row justify-content-center">
                        <div class="col-12  pl-3 pr-3 mt-2">
                            <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="table no-footer table-hover">
                                <thead style="background-color: #2E76BD;">
                                    <tr>
                                        <th>Fecha Compra</th>
                                        <th>Documento</th>
                                        <th>Proveedor</th>
                                        <th>Tipo Pago</th>
                                        <th>Subtotal</th>
                                        <th>Iva</th>
                                        <th>Total</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody *ngIf="validaDtBuy">
                                    <tr *ngFor="let dt of dataBuyTable" style="cursor: pointer;">
                                        <td style="text-align: center;" (click)="setBuy(dt)">{{ dt.fecha}}
                                        </td>
                                        <td style="text-align: center;" (click)="setBuy(dt)">
                                            {{prefict['codigo']}}-{{dt.num_documento.toString().padStart(10, '0') }}
                                        </td>
                                        <td style="text-align: left;" (click)="setBuy(dt)">{{ dt.r_social }}
                                        </td>
                                        <td style="text-align: center;" (click)="setBuy(dt)">{{ dt.tipo_pago}}
                                        </td>
                                        <td style="text-align: right;" (click)="setBuy(dt)">$ {{commonServices.formatNumber(dt.subtotal)}}
                                        </td>
                                        <td style="text-align: right;" (click)="setBuy(dt)">$ {{commonServices.formatNumber(dt.iva_valor)}}
                                        </td>
                                        <td style="text-align: right;" (click)="setBuy(dt)">$ {{ commonServices.formatNumber(dt.total)}}
                                        </td>
                                        <td style="text-align: center;padding: 0px !important;">
                                            <button class="btn btn-danger btn-sm text-center" placement="left" (click)="deleteFacBuy(dt)" ngbTooltip="Eliminar Compra">
                                            <i class="fa fa-trash-o " aria-hidden="true"></i>
                                        </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </fieldset>
            </div>
            <span id="tudiv"></span>
        </div>
    </app-button-radio-active>
</div>
<cc-spiner-procesar [ltexto]="mensajeSpinner" lfulScren=true lTipo="spComprasProLocal"></cc-spiner-procesar>





<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="font-family: 'Poppins1';">
            <div class="card border-0" style="font-size: 11px;background-color: rgb(255 255 255 / 73%);">
                <div class="card-header">
                    <table width="100%">
                        <tr>
                            <td class="text-left">
                                <div class="card-title text-left title_h5 text-uppercase">
                                    <strong>Eliminación de Factura</strong>
                                </div>
                            </td>
                            <td class="text-right">
                                <div class="btn-group">
                                    <div>
                                        <button class="btn btn-success btn-xs button_margin" matTooltip="Guardar" (click)="validateDeleteBuy()"> Eliminar compra
                                        </button>
                                        <button class="btn btn-danger btn-xs button_margin " matTooltip="Cancelar" data-dismiss="modal"> Cancelar
                                        </button>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="input-group pt-2">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" style="background-color: #404a63; color: white;" placeholder="Ingrese observación">Descripción</span>
                                </div>
                                <textarea [(ngModel)]="descriptionDeleteBuy" class="form-control form-control-sm" placeholder="Ingrese una descripción"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
