<link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
<div class="">
    <app-button-radio-active-new titulo="REPORTE - DIARIO GENERAL" filtroBoton="btnsAsiento"
        cstyle="bg-gradient-primary text-white" [groupButton]="vmButtons" (onMetodoGlobal)="metodoGlobal($event)"
        icono="fa fa-buysellads">
        <div class="row">
            <div class="col-12">
                <fieldset class="border card-fieldset">
                    <legend class="w-auto card-legend">Filtros</legend>
                    <div class="row m-0">
                        <div class="col-12 col-md-6 pt-0 pb-0">
                            <app-cc-input-group-prepend label="Desde" styleSpan="size-span-campo">
                                <input type="date" class="form-control" [(ngModel)]="fromDatePicker">
                            </app-cc-input-group-prepend>
                        </div>
                        <div class="col-12 col-md-6 pt-0 pb-0">
                            <app-cc-input-group-prepend label="Hasta" styleSpan="size-span-campo">
                                <input type="date" class="form-control" [(ngModel)]="toDatePicker">
                            </app-cc-input-group-prepend>
                        </div>
                    </div>
                    <div class="row m-0">
                        <div class="col-12 col-md-6 pt-0 pb-0">
                            <div class="input-group input-group-sm mt-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Código desde:</span>
                                </div>
                                <input [(ngModel)]="codigo"  type="text" class="form-control form-control-sm" placeholder="Código cuenta" >
                                <div class="input-group-append">
                                    <button (click)="onClicConsultaPlanCuentas(content)" class="btn btn-sm btn-action" type="button">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6 pt-0 pb-0">
                            <div class="input-group input-group-sm mt-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Nombre
                                        Cuenta:</span>
                                </div>
                                <input type="text" #nameAccountM="ngModel" name="nameAccountM"
                                    [(ngModel)]="nombre" class="form-control form-control-sm"
                                    disabled="true" placeholder="Nombre cuenta mayor">
                            </div>
                        </div>
                    </div>
                    <div class="row m-0">
                        <div class="col-12 col-md-6 pt-0 pb-0">
                            <div class="input-group input-group-sm mt-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Cuenta hasta:</span>
                                </div>
                                <input [(ngModel)]="codigo_hasta"  type="text" class="form-control form-control-sm" placeholder="Código cuenta" >
                                <div class="input-group-append">
                                    <button (click)="onClicConsultaPlanCuentasHasta(content)" class="btn btn-sm btn-action" type="button">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6 pt-0 pb-0">
                            <div class="input-group input-group-sm mt-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Nombre
                                        Cuenta:</span>
                                </div>
                                <input type="text" #nameAccountM="ngModel" name="nameAccountM"
                                    [(ngModel)]="nombre_hasta" class="form-control form-control-sm"
                                    disabled="true" placeholder="Nombre cuenta mayor">
                            </div>
                        </div>
                    </div>
                    <div class="row m-0">
                        <div class="col-12 col-md-6 pt-0 pb-0">
                            <div class="input-group input-group-sm mt-1">
                                <div class="input-group-prepend">
                                    <span class="input-group-text size-span-campo font-weight-bolder"
                                        id="inputGroup-sizing-sm">Centro costo</span>
                                </div>
                                <ng-select style="width: 150px;" loadingText="Cargando.." [loading]="LoadOpcionCentro"
                                    placeholder="-seleccionar centro-" [(ngModel)]="centrocosto"
                                    class="form-control form-control-sm custom-select" (open)="getCentroDetalle()"
                                    [items]="centros" bindLabel="nombre" bindValue="id" appendTo="body"
                                    id="idCentroCosto"></ng-select>
                            </div>
                        </div>
                        <div class="col-12 col-md-6 pt-0 pb-0">
                            <app-cc-input-group-prepend label="Auxiliar" styleSpan="size-span-campo font-weight-bold">
                                <ng-select class="form-control" [(ngModel)]="auxiliar"
                                    [items]="cmb_auxiliar_referencia" bindValue="valor" bindLabel="label"></ng-select>
                            </app-cc-input-group-prepend>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <fieldset class="border card-fieldset">
                    <legend class="w-auto card-legend">Diario General</legend>
                    <div class="row m-0">
                        <div class="col-12">
                            <div [hidden]="!auxSelected" class="justify-content-center">
                                <div class="table-responsive responsive-table content-tabla-general"  style="overflow-x:auto;max-height: 1450px; overflow-y: scroll;">
                                    <table class="table table-striped table-k table-hover h-auto" style="height: 1450px;">
                                        <thead class="sticky-header">
                                            <tr>
                                                <th class="d-none" style="width: 10% !important;text-align: center;">ID</th>
                                                <th >#</th>
                                                <th style="min-width: 100px !important;">FECHA</th>
                                                <th class="d-none" style="min-width: 100px  !important;">ASIENTO</th>
                                                <th style="min-width: 100px  !important;">NO.DOCUMENTO</th>
                                                <th style="min-width: 130px  !important;">CUENTA</th>
                                                <th style="min-width: 380px  !important;">DESCRIPCION</th>
                                                <th style="min-width: 100px !important;text-align: right;padding-right: 10px;">DEBE</th>
                                                <th style="min-width: 100px  !important;text-align: right;padding-right: 10px;">HABER</th>
                                                <th style="min-width: 120px  !important;">COD. PARTIDA</th>
                                                <th style="min-width: 200px  !important;">PARTIDA</th>
                                                <th style="min-width: 100px  !important;" class="text-right">VALOR</th>
    
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngIf="!dtConsultaAsiento.length">
                                                <td colspan="9" class="text-center">
                                                    <h6>No hay asientos para mostrar</h6>
                                                </td>
                                            </tr>
                                            <ng-container *ngFor="let dt of dtConsultaAsiento,let i =index ">
                                                <tr *ngIf="i===0 || dtConsultaAsiento[i].asiento !== dtConsultaAsiento[i-1].asiento ">
                                                    <td style="font-weight: bold;" colspan="4">Asiento : {{ dt.asiento }}</td>

                                                </tr>
                                                <tr >

                                                    <td class="text-center d-none">{{dt.id}}</td>
                                                    <td>{{(i+1)}} </td>
                                                    <td>{{dt.fecha | date: 'dd/MM/yyyy'}}</td>
                                                    <td class="text-center d-none">{{ dt.asiento }}</td>
                                                    <td>{{ dt.num_doc }}</td>
                                                    <td>{{dt.cuenta.replaceAll('.','')}}</td>
                                                    <td>{{dt.descripcion_cuenta}}</td>
                                                    <td  style="text-align: right;padding-right: 10px;">$ {{ dt.debito | number:'1.2-2'}}</td>
                                                    <td  style="text-align: right;padding-right: 10px;">$ {{ dt.credito | number:'1.2-2'}}</td>
                                                    <td> {{ dt.codigo_partida }}</td>
                                                    <td> {{ dt.partida }}</td>
                                                    <td style="text-align: right;padding-right: 10px;">$ {{ dt.valor_partida | number:'1.2-2' }}</td>
                                                </tr>
                                            </ng-container>

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div [hidden]="auxSelected" class="row justify-content-center">
                                <div class="col-12  pl-3 pr-3 mt-2" style="overflow-x:auto;"> 
                                    <p-table [value]="dtConsultaAsientoAuxiliar" rowGroupMode="subheader" groupRowsBy="descripcion_cuenta"  class="table table-striped table-k table-hover">
                                        <ng-template pTemplate="header">
                                            
                                            <tr >
                                                <th class="d-none" style="width: 10% !important;text-align: center;">ID</th>
                                                <!-- <th style="min-width: 100px !important;">FECHA</th> -->
                                                <!-- <th style="min-width: 100px  !important;">NUMERO</th>-->
                                                <th colspan="1">CUENTA</th>
                                                <th colspan="2" style="width: 20%;">DESCRIPCION</th>
                                                <th style="width: 20%;">AUXILIAR</th>
                                                <th style="width: 10%; text-align: right;padding-right: 10px;">DEBE</th>
                                                <th style="width: 10%; text-align: right;padding-right: 10px;">HABER</th>
                                                <th>COD. PARTIDA</th>
                                                <th>PARTIDA</th>
                                                <th style="text-align: right;padding-right: 10px;">VALOR</th>
                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="groupheader" let-dtConsultaAsientoAuxiliar>
                                            <tr pRowGroupHeader style="font-size: 12px;">
                                                <td colspan="1"> 
                                                    <span class="font-bold ml-2">{{dtConsultaAsientoAuxiliar.cuenta.replaceAll('.','')}}</span>
                                                </td>
                                                <td colspan="8">
                                                    <span class="font-bold ml-2">{{dtConsultaAsientoAuxiliar.descripcion_cuenta}}</span>
                                                </td>
                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="body" let-dt let-rowIndex="rowIndex">
                                            <tr style="font-size: 11px;">
                                                <td class="text-center d-none">{{dt.id}}</td>
                                                <td>{{dt.fecha }}</td>
                                                <td>{{ dt.num_doc }}</td>
                                                <td>{{dt.cuenta.replaceAll('.','')}}</td>
                                                <td>{{dt.auxiliar_referencia}}</td>
                                                <td  style="text-align: right;padding-right: 10px;">$ {{ dt.debito | number:'1.2-2'}}</td>
                                                <td  style="text-align: right;padding-right: 10px;">$ {{ dt.credito | number:'1.2-2'}}</td>
                                                <td> {{ dt.codigo_partida }}</td>
                                                <td> {{ dt.partida }}</td>
                                                <td style="text-align: right;padding-right: 10px;"> {{ dt.valor_partida | number:'1.2-2'}}</td>
                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="groupfooter" let-dtConsultaAsientoAuxiliar>
                                            <tr style="font-size: 12px;">
                                                
                                                <td colspan="4" class="text-center font-weight-bold">Totales</td>
                                                <td colspan="1" class="font-weight-bold" style="text-align: right;padding-right: 10px;">$ {{calcularTotalDebe(dtConsultaAsientoAuxiliar.descripcion_cuenta) | number:'1.2-2'}}</td>
                                                <td colspan="1" class="font-weight-bold" style="text-align: right;padding-right: 10px;">$ {{calcularTotalHaber(dtConsultaAsientoAuxiliar.descripcion_cuenta) | number:'1.2-2'}}</td>
                                                <td colspan="2" class="text-right"></td>
                                                <td colspan="1" class="font-weight-bold" style="text-align: right;padding-right: 10px;">$ {{calcularTotalPartida(dtConsultaAsientoAuxiliar.descripcion_cuenta) | number:'1.2-2'}}</td>
                                            
                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="emptymessage">
                                            <tr style="font-size: 12px;">
                                                <td class="EmptyTable text-center" [attr.colspan]="9">
                                                    No hay información para mostrar
                                                 </td>
                                            </tr>
                                        </ng-template>
                                    </p-table>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </app-button-radio-active-new>
</div>

<cc-spiner-procesar [ltexto]="mensajeSpinner" lfulScren=true lTipo="spAsiento"></cc-spiner-procesar>