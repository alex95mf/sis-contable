<div class="mt-4">
    <app-button-radio-active titulo="Facturación venta" filtroBoton="btnsSales" cstyle="bg-gradient-primary text-white"
        [groupButton]="vmButtons" (onMetodoGlobal)="metodoGlobal($event)" icono="fas fa-file-alt">

        <div class="row mt-3">
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Razón social</span>
                    </div>
                    <ng-select id="IdRolesUsersDoc" class="form-control custom" appendTo="body" [searchable]="true"
                        [disabled]="actions.dComponet || dataProducto.length > 1"
                        style="padding-left: 7px;font-size: 13px;" [(ngModel)]="customerSelect" [clearable]="false"
                        (keyup)="getCustomerFilter($event.target.value)" (ngModelChange)="getCustomer($event)">
                        <ng-option [value]="0">Seleccione razón social</ng-option>
                        <ng-option *ngFor="let d of arrayCustomerAux" [value]="d.id_cliente">
                            {{d.razon_social}}</ng-option>
                    </ng-select>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Cupo crédito</span>
                    </div>
                    <input placeholder="cupo crédito" type="text" class="form-control form-control-sm text-right pr-1"
                        id="idCupoCre" [disabled]="true" [(ngModel)]="customer.cupo_credito">
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Vendedor:</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" [disabled]="true"
                        [(ngModel)]="dataUser.nombre">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Ruc</span>
                    </div>
                    <input placeholder="Ruc cliente" type="text" class="form-control form-control-sm" [disabled]="true"
                        [(ngModel)]="customer.num_documento">
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Saldo crédito</span>
                    </div>
                    <input placeholder="saldo crédito" type="text" class="form-control form-control-sm text-right pr-1"
                        id="idSalCre" [disabled]="true" [(ngModel)]="customer.saldo_credito">
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Asesor</span>
                    </div>
                    <input placeholder="asesor financiero" type="text" class="form-control form-control-sm"
                        id="idAsesor" [disabled]="true" [(ngModel)]="customer['asesor']['nombre']">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Tipo Documento</span>
                    </div>
                    <select class="form-control form-control-sm custom-select" [(ngModel)]="dataBuy.idTipDocSelect"
                        (ngModelChange)="getNumautNumFac($event)" id="idTipDocSelect">
                        <!-- <option [value]="0">Seleccione tipo</option> -->
                        <option *ngFor="let d of dataBuy.tip_doc" [value]="d.id">
                            {{d.nombre}}
                        </option>
                    </select>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Tipo pago</span>
                    </div>
                    <select class="form-control form-control-sm custom-select" [(ngModel)]="dataBuy.tipoPagoSelect"
                        (ngModelChange)="changeDisabledBtn()" id="idTipoPagoSelect">
                        <option [value]="0">Tipo pago</option>
                        <option *ngFor="let d of dataBuy.tipo_pago" [value]="d.valor">
                            {{d.valor}}
                        </option>
                    </select>
                    <div class="input-group-append">
                        <button class="btn btn-primary btn-sm" (click)="setNumCuotas()"
                            style="box-shadow: unset;outline: unset;" id="idbtndifered" [disabled]="!flagBtnDired "
                            placement="top" ngbTooltip="Diferir cuotas">
                            <i class="fa fa-pencil" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Subtotal</span>
                    </div>
                    <input type="text" class="form-control form-control-sm text-right pr-2" disabled
                        placeholder="$ {{dataTotales.subTotalPagado.toFixed(4)}}" min="0">
                </div>
            </div>
        </div>



        <div class="row">
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">No. Factura</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" [disabled]="true" [(ngModel)]="num_fac">
                </div>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Forma pago</span>
                    </div>
                    <select class="form-control form-control-sm custom-select" [(ngModel)]="dataBuy.formaPagoSelect"
                        id="idFormaPago">
                        <option [value]="0">Forma pago</option>
                        <option *ngFor="let d of dataBuy.forma_pago" [value]="d.valor">
                            {{d.valor}}
                        </option>
                    </select>
                </div>
            </div>

            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">{{ivaConverter}} %
                            Iva</span>
                    </div>
                    <input type="text" class="form-control form-control-sm text-right pr-2" disabled
                        placeholder="$ {{dataTotales.ivaPagado.toFixed(4)}}" min="0">
                </div>
            </div>
        </div>

        <div class="row">  
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">No. Autorización</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" [disabled]="true" [(ngModel)]="num_aut">
                </div>
            </div>
            <div class="col-sm-4">
                <app-cc-input-group-prepend label="Fecha venta" styleSpan="size-span-campo">
                    <ejs-datepicker [(ngModel)]="dateConverter" class="form-control" name="dateFrom" format='yyyy-MM-dd'
                        id="idNominaDatef">
                    </ejs-datepicker>
                </app-cc-input-group-prepend>
            </div>
            <div class="col-sm-4">
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Total</span>
                    </div>
                    <input type="text" class="form-control form-control-sm text-right pr-2" disabled
                        placeholder="$ {{dataTotales.totalPagado.toFixed(4)}}" min="0">
                </div>
            </div>
        </div>
        <div class="row mb-2">
            <div class="col-sm-8">
                <div class="input-group pt-2">
                    <div class="input-group-prepend">
                        <span class="input-group-text" style="background-color: #404a63; color: white;"
                            placeholder="Ingrese observación">Observación</span>
                    </div>
                    <textarea class="form-control form-control-sm" aria-label="With textarea"
                        placeholder="Ingrese una observación" [(ngModel)]="customer.observationSales"></textarea>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12 filters pl-2 pr-2 ">
                <div class="row justify-content-end pt-2">
                    <div class="col-3 col-sm-3 col-md-2 col-lg-2 col-xl-2 text-right btn-add">
                        <button class="btn btn-success btn-sm" placement="top"
                            ngbTooltip="Agregar productos a la cotización" (click)="addProduct()"
                            [disabled]="actions.dComponet || customerSelect == 0">
                            <i class="fa fa-plus" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-12  pl-3 pr-3 mt-2">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Código</th>
                                    <th scope="col">Precio</th>
                                    <th scope="col">Descuento</th>
                                    <th scope="col">Stock</th>
                                    <th scope="col">Cantidad</th>
                                    <th scope="col">P/U</th>
                                    <th scope="col">Total</th>
                                    <th scope="col" class="text-center">Acción</th>
                                </tr>
                            </thead>
                            <tbody style="width: 100%;">
                                <tr *ngFor="let d of dataProducto; let i = index">
                                    <td style="width: 18%;" *ngIf="d.action"><input type="text" placeholder="Producto"
                                            [(ngModel)]="d.nombre" [disabled]="true"></td>
                                    <td style="width: 13%;" *ngIf="d.action">
                                        <input type="text" placeholder="Código" [(ngModel)]="d.codigoProducto"
                                            [disabled]="true">
                                    </td>
                                    <td style="width: 10%;" *ngIf="d.action"><input type="text"
                                            placeholder="$ {{d.precio_normal}}" [disabled]="true"
                                            style="text-align: right !important;"></td>

                                    <td style="width: 10%;" *ngIf="d.action"><input type="text"
                                            placeholder="{{d.porcen_promocion}} %" [disabled]="true"
                                            style="text-align: right !important;"></td>

                                    <td style="width: 7%;" *ngIf="d.action">
                                        <div *ngIf="(d.stock-d.cantidad_reservada) > 0">
                                            <input type="text" placeholder="0.00" style="text-align: right !important;"
                                                placeholder="{{(d.stock-d.cantidad_reservada).toFixed(2)}}"
                                                [disabled]="true">
                                        </div>
                                        <div *ngIf="(d.stock-d.cantidad_reservada) <= 0">
                                            <input type="text" placeholder="0.00" [disabled]="true"
                                                style="text-align: right !important;">
                                        </div>
                                    </td>

                                    <td style="width: 10%;text-align: right;" *ngIf="d.action">
                                        <input type="text" class="form-control form-control-sm" placeholder="0.00"
                                            style="text-align: right;padding-right: 10px;" [(ngModel)]="d.quantity"
                                            (keyup)="sumTotal(i)" min="0" id="quantyId"
                                            (keypress)="commonServices.FormatDecimalVal($event)"
                                            [disabled]="actions.dComponet">
                                    </td>

                                    <td style="width: 10%;" *ngIf="d.action">
                                        <input type="text" class="form-control form-control-sm" placeholder="$ 0.00"
                                            style="text-align: right;padding-right: 10px;" [(ngModel)]="d.price"
                                            (keyup)="sumTotal(i)" min="0"
                                            (keypress)="commonServices.FormatDecimalVal($event)"
                                            [disabled]="actions.dComponet">
                                    </td>
                                    <td style="width: 9%;" *ngIf="d.action">
                                        <input type="text" placeholder="$ {{d.totalAux}}" [disabled]="true"
                                            class="form-control form-control-sm" style="text-align: right !important;">
                                    </td>
                                    <td style="width: 9%;text-align: center;" *ngIf="d.action">
                                        <button class="btn btn-danger btn-sm" placement="top"
                                            ngbTooltip="Eliminar Items" (click)="deleteItems(i)"
                                            [disabled]="actions.dComponet">
                                            <i class="fa fa-trash-o" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-3 mt-4">
            <div class="col-4">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="input-group input-group-sm mt-1" placement="top" ngbTooltip="{{valueLethers}}">
                            <div class="input-group-prepend">
                                <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Total en
                                    letras</span>
                            </div>
                            <input placeholder="total en letras" type="text" class="form-control form-control-sm"
                                id="idtotalsLetras" [disabled]="true" [(ngModel)]="valueLethers">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-8">
                <div class="row">
                    <div class="col-sm-4">
                        <div class="input-group input-group-sm mt-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Total
                                    Factura</span>
                            </div>
                            <input placeholder="$ {{dataTotales.totalPagado.toFixed(4)}}" type="text"
                                class="form-control form-control-sm text-right" id="idtotalFacturado" [disabled]="true">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="input-group input-group-sm mt-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Total
                                    Recibido</span>
                            </div>
                            <input placeholder="$ {{dataTotales.totalPagado.toFixed(4)}}" type="text"
                                class="form-control form-control-sm text-right" id="idtotalRecibido" [disabled]="true">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="input-group input-group-sm mt-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text size-span-campo" id="inputGroup-sizing-sm">Total
                                    Cambio</span>
                            </div>
                            <input placeholder="$ {{dataTotales.totalPagado.toFixed(4)}}" type="text"
                                class="form-control form-control-sm text-right" id="idtotalRecibido" [disabled]="true">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </app-button-radio-active>
</div>
<cc-spiner-procesar [ltexto]="mensajeSpinner" lfulScren=true lTipo="spSales"></cc-spiner-procesar>