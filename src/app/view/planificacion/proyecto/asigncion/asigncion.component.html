<div class="my-2">
    <app-button-radio-active-new [titulo]="fTitle" icono="fas fa-sitemap" cstyle="bg-light text-dark"
        filtroBoton="btnsAttrs" [groupButton]="vmButtons" (onMetodoGlobal)="metodoGlobal($event)">
        <div class="row m-0">
            <div class="col-12">
        <fieldset class="border card-fieldset">
            <legend class="w-auto card-legend">Filtros</legend>
            <div class="row m-0">

                <div class="col-12 col-md-4 pt-0 pb-0">
                    <app-cc-input-group-prepend label="Periodo" styleSpan="size-span-campo font-weight-bold">
                        <ng-select class="form-control" [clearable]="false" [markFirst]="false" [(ngModel)]="periodoSelected"
                            [items]="periodos" bindValue="id" bindLabel="periodo" (change)="handleSelectPeriodo($event, item)"></ng-select>
                    </app-cc-input-group-prepend>
                </div>
                <div class="col-12 col-md-4 pt-0 pb-0">
                    <app-cc-input-group-prepend label="Programa" styleSpan="size-span-campo font-weight-bold">
                        <ng-select class="form-control" [clearable]="false" [markFirst]="false" [(ngModel)]="programaSelected" (change)="handleSelectPrograma($event)"
                            [items]="programas" bindValue="valor" bindLabel="label"></ng-select>
                    </app-cc-input-group-prepend>
                </div>
                <div class="col-12 col-md-4 pt-0 pb-0">
                    <app-cc-input-group-prepend label="Departamento" styleSpan="size-span-campo font-weight-bold">
                        <ng-select class="form-control" [clearable]="false" [markFirst]="false" [(ngModel)]="departamentoSelected" (change)="handleSelectDepartamento($event)"
                        [items]="departamentosFilter" bindValue="valor" bindLabel="label"></ng-select>
                    </app-cc-input-group-prepend>
                </div>
                <!-- <div class="col-1">
                    <button class="btn btn-sm btn-primary" (click)="handleClickBuscar()"
                        [disabled]="periodoSelected == undefined || programaSelected == undefined || departamentoSelected == undefined">
                        <i class="fas fa-search"></i> BUSCAR
                    </button>
                </div> -->
            </div>
            
            <div *ngIf="departamentoSelected != undefined"  class="row m-0">
                <div class="col-12 col-md-4 pt-0 pb-0">
                    <app-cc-input-group-prepend label="Agregar Atribucion" styleSpan="size-span-campo font-weight-bold">
                        <button matTooltip="Crear atribución" (click)="expandNuevaAtribucion()" class="btn btn-sm btn-primary">
                                <i class="fa fa-plus"></i>
                            </button>
                    </app-cc-input-group-prepend>
                </div>
            </div>
        </fieldset>
    </div></div>


        <div class="row m-0">
            <div class="col-12">
                <fieldset class="border card-fieldset">
                    <legend class="w-auto card-legend">Presupuesto de Departamento</legend>
                    <div class="row m-0">
                        <div class="col-12 col-md-4 pt-0 pb-0">
                            <div class="input-group input-group-sm">
                                <div class="input-group-prepend">
                                    <span class="input-group-text font-weight-bold size-span-campo">Presupuesto</span>
                                    <span class="input-group-text font-weight-bold">$</span>
                                </div>
                                <input currencyMask [options]="{prefix: '', nullable: true}" class="form-control" readonly
                                    [ngModel]="presupuesto?.presupuesto ?? 0">
                            </div>
                            <!-- <app-cc-input-group-prepend label="Presupuesto" styleSpan="size-span-campo font-weight-bold">
                                <div class="input-group-prepend">
                                    <span class="input-group-text font-weight-bold">$</span>
                                </div>
                                <input currencyMask [options]="{prefix: '', nullable: true}" class="form-control" readonly [ngModel]="presupuesto?.presupuesto">
                            </app-cc-input-group-prepend> -->
                        </div>
                        <div class="col-12 col-md-4 pt-0 pb-0">
                            <div class="input-group input-group-sm">
                                <div class="input-group-prepend">
                                    <span class="input-group-text font-weight-bold size-span-campo">Asignado</span>
                                    <span class="input-group-text font-weight-bold">$</span>
                                </div>
                                <input currencyMask [options]="{prefix: '', nullable: true}" class="form-control" readonly
                                    [ngModel]="presupuesto?.asignado ?? 0">
                            </div>
                            <!-- <app-cc-input-group-prepend label="Asignado" styleSpan="size-span-campo font-weight-bold">
                                <div class="input-group-prepend">
                                    <span class="input-group-text font-weight-bold">$</span>
                                </div>
                                <input currencyMask [options]="{prefix: '', nullable: true}" class="form-control" readonly [ngModel]="presupuesto?.asignado">
                            </app-cc-input-group-prepend> -->
                        </div>
                        <div class="col-12 col-md-4 pt-0 pb-0">
                            <div class="input-group input-group-sm">
                                <div class="input-group-prepend">
                                    <span class="input-group-text font-weight-bold size-span-campo">Por Asignar</span>
                                    <span class="input-group-text font-weight-bold">$</span>
                                </div>
                                <input currencyMask [options]="{prefix: '', nullable: true}" class="form-control" readonly
                                    [ngModel]="presupuesto?.disponible ?? 0">
                            </div>
                            <!-- <app-cc-input-group-prepend label="Disponible" styleSpan="size-span-campo font-weight-bold">
                                <div class="input-group-prepend">
                                    <span class="input-group-text font-weight-bold">$</span>
                                </div>
                                <input currencyMask [options]="{prefix: '', nullable: true}" class="form-control" readonly [ngModel]="presupuesto?.disponible">
                            </app-cc-input-group-prepend> -->
                        </div>
                    </div>
                </fieldset>
            </div>
            
        </div>
        
    </app-button-radio-active-new>


 


    <div class="table-responsive" style="max-height: 600px; overflow-y: scroll;">
        <table class="table table-striped table-bordered table-k table-hover" style="width: 1800px;">
            <thead class="sticky-header">
                <tr>
                    <th class="w-25 col-nombre">Atribución</th>
                    <th>Indicador de Gestion</th>
                    <th>Formula del Indicador de Gestion</th>
                    <th>Frecuencia de Medicion</th>
                    <th>Meta POA</th>
                    <th>Tiempo previsto</th>
                    <th style="width: 20%;">
                        <div class="row">
                            <div class="col">Programaci&oacute;n Trimestral</div>
                        </div>
                        <div class="row">
                            <div class="col">1</div>
                            <div class="col">2</div>
                            <div class="col">3</div>
                            <div class="col">4</div>
                        </div>
                    </th>
                    <th>Total</th>
                    <!-- <th>Responsables</th> -->
                    <!-- <th>Acciones</th> -->
                </tr>
            </thead>
            <tbody>
                <tr *ngIf="!atribuciones?.length">
                    <td colspan="9" class="text-center">
                        <h6>No hay datos.</h6>
                    </td>
                </tr>
                <tr *ngFor="let atribucion of atribuciones, let i = index">
                    <td class="col-nombre">
                        <p>{{(i+1) + '.- '}}{{ atribucion.valor }}</p>
                        <div *ngIf="!atribucion.atribucion_bienes_count; then thenBlock else elseBlock"></div>
                        <ng-template #thenBlock>
                            <button [disabled]="atribucion.atribucion_data.id == null"
                                class="btn btn-sm btn-link" (click)="expandBienes(atribucion)">
                                <i class="fas fa-box-open text-danger"></i>
                                Bienes y Servicios pendientes
                            </button>
                        </ng-template>
                        <ng-template #elseBlock>
                            <button type="button" class="btn btn-sm btn-link"
                                (click)="expandBienes(atribucion)">
                                <i class="fas fa-box-check text-primary"></i>
                                Bienes y Servicios asignados
                                <span class="badge badge-primary">{{ atribucion.atribucion_bienes_count }}</span>
                            </button>
                        </ng-template>
                    </td>

                    <td>
                        <input type="text" class="form-control form-control-sm border border-secondary"
                            [(ngModel)]="atribucion.atribucion_data.indicador">
                    </td>
                    <td>
                        <textarea type="number" class="form-control form-control-sm border border-secondary"
                            [(ngModel)]="atribucion.atribucion_data.formula"></textarea>
                    </td>
                    <td>
                        <ng-select id="frecMedicion" appendTo="body" class="form-control form-control-sm border border-secondary"
                            [clearable]="false" [items]="frecMedicion" bindValue="id_catalogo" bindLabel="valor" [(ngModel)]="atribucion.atribucion_data.fk_frecuencia">
                        </ng-select>
                    </td>
                    <td>
                        <div class="row">
                            <div class="col">
                                <ng-select style="width: 180px" appendTo="body" class="form-control form-control-sm border border-secondary" [(ngModel)]="atribucion.atribucion_data.fk_meta"
                                    [clearable]="false" [items]="lista_metas" bindValue="id_catalogo" bindLabel="valor" (change)="handleSelectMeta($event, atribucion)"
                                    >
                                </ng-select>
                            </div>
                        </div>
                        <div class="row" [ngClass]="{ 'd-none': atribucion.atribucion_data.id == null || atribucion.atribucion_data.meta == null }">
                            <div class="col">
                                <button class="btn btn-sm btn-link" (click)="expandTareas(atribucion)">
                                    <i class="fas fa-tasks"></i> Tareas
                                </button>
                            </div>
                        </div>

                    </td>

                    <td>
                        <ng-select class="form-control form-control-sm border border-secondary" [clearable]="false" appendTo="body"
                            [items]="tiempoPrevision" bindValue="id_catalogo" bindLabel="valor" [(ngModel)]="atribucion.atribucion_data.fk_prevision">
                        </ng-select>
                    </td>
                    <td>
                        <div class="row">
                            <div class="col">
                                <div class="input-group input-group-sm">
                                    <input type="number" class="form-control"
                                        (keypress)="validaciones.numberOnly($event)"
                                        [(ngModel)]="atribucion.atribucion_data.cuatrimestre1"
                                        (input)="sumaRealizacion(atribucion)" min="0" max="100">
                                    <div class="input-group-append"><label
                                            class="input-group-text font-weight-bolder">%</label></div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="input-group input-group-sm">
                                    <input type="number" class="form-control"
                                        (keypress)="validaciones.numberOnly($event)"
                                        [(ngModel)]="atribucion.atribucion_data.cuatrimestre2"
                                        (input)="sumaRealizacion(atribucion)" min="0" max="100">
                                    <div class="input-group-append"><label
                                            class="input-group-text font-weight-bolder">%</label></div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="input-group input-group-sm">
                                    <input type="number" class="form-control"
                                        (keypress)="validaciones.numberOnly($event)"
                                        [(ngModel)]="atribucion.atribucion_data.cuatrimestre3"
                                        (input)="sumaRealizacion(atribucion)" min="0" max="100">
                                    <div class="input-group-append"><label
                                            class="input-group-text font-weight-bolder">%</label></div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="input-group input-group-sm">
                                    <input type="number" class="form-control"
                                        (keypress)="validaciones.numberOnly($event)"
                                        [(ngModel)]="atribucion.atribucion_data.cuatrimestre4"
                                        (input)="sumaRealizacion(atribucion)" min="0" max="100">
                                    <div class="input-group-append"><label
                                            class="input-group-text font-weight-bolder">%</label></div>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm">
                            <input type="number" class="form-control" readonly
                                [value]="atribucion.realizacion ?? 0" min="0" max="100">
                            <div class="input-group-append mr-1"><label
                                    class="input-group-text font-weight-bolder">%</label></div>
                        </div>
                    </td>
                    <!-- <td></td> -->
                </tr>
            </tbody>
        </table>
    </div>
</div>
<cc-spiner-procesar [ltexto]="mensajeSpinner" lfulScren=true lTipo="plaAtriAsig"></cc-spiner-procesar>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-body mt-1">
                <app-button-radio-active-new titulo="{{newCatalogo}}" filtroBoton="btnAtribucionModal"
                    cstyle="bg-gradient-primary text-white" [groupButton]="vmButtons"
                    (onMetodoGlobal)="metodoGlobal($event)" icono="fab fa-product-hunt">
                    <div class="row mb-4 mt-1">
                        <div class="col-sm-12 mt-1">
                            <app-cc-input-group-prepend label="{{valueLabel}}" styleSpan="size-span-campo">
                                     <textarea type="text" #valueCata="ngModel" name="valueCata" class="form-control form-control-sm border border-secondary"
                                     [(ngModel)]="valorCatalogo" placeholder="Ingrese valor" style="box-shadow: unset;outline: unset;"id="IdValorCatalogo"></textarea>
                            </app-cc-input-group-prepend>
                        </div>
                    </div>
                </app-button-radio-active-new>
            </div>
        </div>
    </div>
</div>
